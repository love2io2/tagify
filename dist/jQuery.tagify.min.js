!function(t){function e(t,e){if(!t)return console.warn("Tagify: ","invalid input element ",t),this;if(this.settings=this.extend({},e,this.DEFAULTS),this.settings.readonly=t.hasAttribute("readonly"),t.pattern)try{this.settings.pattern=new RegExp(t.pattern)}catch(t){}if(this.settings&&this.settings.delimiters)try{this.settings.delimiters=new RegExp("["+this.settings.delimiters+"]","g")}catch(t){}this.id=Math.random().toString(36).substr(2,9),this.value=[],this.DOM={},this.extend(this,new this.EventDispatcher),this.build(t),this.events.customBinding.call(this),this.events.binding.call(this)}t.fn.tagify=function(i){return this.each(function(){var n,s=t(this);if(s.data("tagify"))return this;(n=new e(s[0],i)).isJQueryPlugin=!0,s.data("tagify",n)})},e.prototype={DEFAULTS:{delimiters:",",pattern:"",maxTags:1/0,callbacks:{},addTagOnBlur:!1,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,autoComplete:!0,autoSuggest:!0,suggestionsMinChars:2,maxSuggestions:10},customEventsList:["add","remove","duplicate","maxTagsExceed","blacklisted","notWhitelisted"],parseHTML:function(t){var e=document.createElement("template");return e.innerHTML=t.trim(),e.content.firstChild},escapeHtml:function(t){var e=document.createTextNode(t),i=document.createElement("p");return i.appendChild(e),i.innerHTML},build:function(t){var e=t.value,i='\n                <tags class="'+t.className+" "+(this.settings.readonly?"readonly":"")+'">\n                    <div contenteditable data-placeholder="'+t.placeholder+'" class="tagify--input placeholder"></div>\n                </tags>';this.DOM.originalInput=t,this.DOM.scope=this.parseHTML(i),this.DOM.input=this.DOM.scope.querySelector("[contenteditable]"),t.parentNode.insertBefore(this.DOM.scope,t),this.settings.autoSuggest&&this.settings.whitelist.length&&this.dropdown.init.call(this),e&&this.addTags(e).forEach(function(t){t&&t.classList.add("tagify--noAnim")})},destroy:function(){this.DOM.scope.parentNode.removeChild(this.DOM.scope)},extend:function(t,e,i){function n(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}return t instanceof Object||(t={}),i?(n(t,i),n(t,e)):n(t,e),t},EventDispatcher:function(){var e=document.createTextNode("");this.off=e.removeEventListener.bind(e),this.on=e.addEventListener.bind(e),this.trigger=function(i,n){var s;if(i)if(this.isJQueryPlugin)t(this.DOM.originalInput).triggerHandler(i,[n]);else{try{s=new CustomEvent(i,{detail:n})}catch(t){(s=document.createEvent("Event")).initEvent("toggle",!1,!1)}e.dispatchEvent(s)}}},events:{customBinding:function(){var t=this;this.customEventsList.forEach(function(e){t.on(e,t.settings.callbacks[e])})},binding:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=this.events.callbacks,n=this._CBR=this._CBR||{paste:["input",i.onPaste.bind(this)],focus:["input",i.onFocusBlur.bind(this)],blur:["input",i.onFocusBlur.bind(this)],keydown:["input",i.onKeydown.bind(this)],click:["scope",i.onClickScope.bind(this)]},s=e?"addEventListener":"removeEventListener";for(var o in n)this.DOM[n[o][0]][s](o,n[o][1]);e&&(this.DOM.input.addEventListener("input",i.onInput.bind(this)),this.isJQueryPlugin&&t(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this)))},callbacks:{onFocusBlur:function(t){var e=t.target.textContent.trim();"focus"==t.type?t.target.classList.remove("placeholder"):"blur"==t.type&&e?this.settings.addTagOnBlur&&this.addTags(e).length&&(t.target.textContent=""):(t.target.classList.add("placeholder"),this.DOM.input.removeAttribute("style"),this.dropdown.hide.call(this))},onKeydown:function(t){var e,i=t.target.textContent;if("Backspace"!=t.key||""!=i&&8203!=i.charCodeAt(0)||(e=(e=this.DOM.scope.querySelectorAll("tag:not(.tagify--hide)"))[e.length-1],this.removeTag(e)),"Escape"==t.key&&(t.target.textContent="",t.target.blur()),"Enter"==t.key)return t.preventDefault(),i=t.target.textContent,this.addTags(i).length&&(t.target.textContent=""),t.target.textContent.replace(/<br>/g,""),!1},onInput:function(t){var e=t.target.textContent.slice(),i=(e[e.length-1],e.length>=this.settings.suggestionsMinChars);-1!=e.search(this.settings.delimiters)?this.addTags(e).length&&(t.target.textContent=""):this.settings.autoSuggest&&this.settings.whitelist.length&&this.dropdown[i?"show":"hide"].call(this,e)},onPaste:function(t){},onClickScope:function(t){"TAGS"==t.target.tagName&&this.DOM.input.focus(),"X"==t.target.tagName&&this.removeTag(t.target.parentNode)}}},buildDataList:function(){var t,e="",i=document.createElement("datalist");for(i.id="tagifySuggestions"+this.id,i.innerHTML="<label>                                 select from the list:                                 <select>                                     <option value=''></option>                                     [OPTIONS]                                 </select>                             </label>",t=this.settings.whitelist.length;t--;)e+="<option>"+this.settings.whitelist[t]+"</option>";return i.innerHTML=i.innerHTML.replace("[OPTIONS]",e),i},getNodeIndex:function(t){for(var e=0;t=t.previousSibling;)3==t.nodeType&&/^\s*$/.test(t.data)||e++;return e},isTagDuplicate:function(t){return this.value.some(function(e){return t.toLowerCase()===e.value.toLowerCase()})},markTagByValue:function(t,e){var i,n;if(!e)for(n=(i=this.DOM.scope.querySelectorAll("tag")).length;n--;)i[n].value.toLowerCase().includes(t.toLowerCase())&&(e=i[n]);return!!e&&(e.classList.add("tagify--mark"),setTimeout(function(){e.classList.remove("tagify--mark")},2e3),!0)},isTagBlacklisted:function(t){return t=t.split(" "),this.settings.blacklist.filter(function(e){return-1!=t.indexOf(e)}).length},isTagWhitelisted:function(t){return-1!=this.settings.whitelist.indexOf(t)},addTags:function(t){function e(t){var e,i=t.value.trim(),n=this.value.length>=this.settings.maxTags;return i?this.settings.pattern&&!this.settings.pattern.test(i)?"pattern":this.isTagDuplicate(i)&&(this.trigger("duplicate",i),!this.settings.duplicates)?"duplicate":!!(!this.isTagBlacklisted(i)&&(!this.settings.enforceWhitelist||this.isTagWhitelisted(i))&&!n)||(t.class=t.class?t.class+" tagify--notAllowed":"tagify--notAllowed",n?e="maxTagsExceed":this.isTagBlacklisted(i)?e="blacklisted":this.settings.enforceWhitelist&&!this.isTagWhitelisted(i)&&(e="notWhitelisted"),this.trigger(e,{value:i,index:this.value.length}),"notAllowed"):"empty"}function i(t){this.DOM.scope.insertBefore(t,this.DOM.input)}var n=this,s=[];return this.DOM.input.removeAttribute("style"),(t=function(t){var e=this.settings.whitelist[0]instanceof Object,i=t instanceof Array&&"value"in t[0],n=t;if(i)return n;if(!i&&"string"==typeof t&&e){var s=this.settings.whitelist.filter(function(e){return e.value.toLowerCase()==t.toLowerCase()});s[0]&&(i=!0,n=s)}if(!i){if(!(t=t.trim()))return[];n=t.split(this.settings.delimiters).map(function(t){return{value:t.trim()}})}return n.filter(function(t){return t})}.call(this,t)).forEach(function(t){var o=e.call(n,t);if(!0===o||"notAllowed"==o){var r=n.createTagElem(t);i.call(n,r),"notAllowed"==o?setTimeout(function(){n.removeTag(r,!0)},1e3):(n.value.push(t),n.update(),n.trigger("add",n.extend({},t,{index:n.value.length,tag:r})),s.push(r))}}),s},createTagElem:function(t){var e,i=this.escapeHtml(t.value),n="<tag>\n                            <x></x><div><span title='"+i+"'>"+i+"</span></div>\n                        </tag>";return e=this.parseHTML(n),function(t,e){var i,n=Object.keys(e);for(i=n.length;i--;){var s=n[i];if(!e.hasOwnProperty(s))return;t.setAttribute(s,e[s])}}(e,t),e},removeTag:function(t,e){var i,n=this.getNodeIndex(t);t&&(t.style.width=parseFloat(window.getComputedStyle(t).width)+"px",document.body.clientTop,t.classList.add("tagify--hide"),setTimeout(function(){t.parentNode.removeChild(t)},400),e||(i=this.value.splice(n,1)[0],this.update(),this.trigger("remove",this.extend({},i,{index:n,tag:t}))))},removeAllTags:function(){this.value=[],this.update(),Array.prototype.slice.call(this.DOM.scope.querySelectorAll("tag")).forEach(function(t){return t.parentNode.removeChild(t)})},update:function(){var t=this.value.map(function(t){return t.value}).join(",");this.DOM.originalInput.value=t},dropdown:{init:function(){this.DOM.dropdown=this.dropdown.build()},build:function(){var t=document.createElement("div");return t.className="tagify__dropdown",t},show:function(t){var e=this.dropdown.filterListItems.call(this,t),i=this.dropdown.createListHTML(e);e.length?(this.settings.autoComplete&&this.DOM.input.setAttribute("data-suggest",e[0].substring(t.length)),this.DOM.dropdown.innerHTML=i,this.dropdown.position.call(this),this.DOM.dropdown.parentNode||(document.body.appendChild(this.DOM.dropdown),this.events.binding.call(this,!1),this.dropdown.events.binding.call(this))):this.dropdown.hide.call(this)},hide:function(){this.DOM.dropdown.parentNode&&(this.DOM.input.removeAttribute("data-suggest"),document.body.removeChild(this.DOM.dropdown),window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),this.events.binding.call(this))},position:function(){var t=this.DOM.scope.getBoundingClientRect();this.DOM.dropdown.style.cssText="left: "+t.left+window.pageXOffset+"px;                                                top: "+(t.top+t.height-1+window.pageYOffset)+"px;                                                width: "+t.width+"px"},events:{binding:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.dropdown._CBR=this.dropdown.events._CBR||{position:this.dropdown.position.bind(this),onKeyDown:this.dropdown.events.callbacks.onKeyDown.bind(this),onMouseOver:this.dropdown.events.callbacks.onMouseOver.bind(this),onClick:this.dropdown.events.callbacks.onClick.bind(this)},i=t?"addEventListener":"removeEventListener";window[i]("resize",e.position),window[i]("keydown",e.onKeyDown),window[i]("click",e.onClick),this.DOM.dropdown[i]("mouseover",e.onMouseOver)},callbacks:{onKeyDown:function(t){var e=this.DOM.dropdown.querySelectorAll("[class$='--active']")[0];"ArrowDown"!=t.key&&"ArrowUp"!=t.key||(t.preventDefault(),e&&(e=e["ArrowUp"==t.key?"previousElementSibling":"nextElementSibling"]),e||(e=this.DOM.dropdown.children["ArrowUp"==t.key?this.DOM.dropdown.children.length-1:0]),this.dropdown.highlightOption.call(this,e)),"Escape"==t.key&&this.dropdown.hide.call(this),"Enter"==t.key&&(this.DOM.input.textContent="",e&&this.addTags(e.textContent),this.dropdown.hide.call(this))},onMouseOver:function(t){t.target.className.includes("__item")&&this.dropdown.highlightOption.call(this,t.target)},onClick:function(t){t.target.className.includes("tagify__dropdown__item")&&(this.DOM.input.textContent="",this.addTags(t.target.textContent)),this.dropdown.hide.call(this)}}},highlightOption:function(t){if(t){var e="tagify__dropdown__item--active";this.DOM.dropdown.querySelectorAll("[class$='--active']").forEach(function(t){return t.classList.remove(e)}),t.classList.add(e)}},filterListItems:function(t){if(!t)return"";for(var e,i=[],n=this.settings.whitelist,s=this.settings.maxSuggestions||1/0,o=0;o<n.length&&(0==(e=n[o]instanceof Object?n[o].value:n[o]).toLowerCase().replace(/\s/g,"").indexOf(t.toLowerCase().replace(/\s/g,""))&&s--&&i.push(e),0!=s);o++);return i},createListHTML:function(t){return t.map(function(t){return"<div class='tagify__dropdown__item'>"+t+"</div>"}).join("")}}}}(jQuery);